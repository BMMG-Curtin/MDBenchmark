Update and add more unit tests.
